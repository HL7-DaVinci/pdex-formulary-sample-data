# QHP to FHIR

This project uses QHP data to create FHIR resources based on the [DaVinci US Drug Formulary Implementation Guide Draft STU2](https://build.fhir.org/ig/HL7/davinci-pdex-formulary/branches/stu2-draft/). Currently, the following are created:

<ul>
  <li>
    <strong><a href="https://build.fhir.org/ig/HL7/davinci-pdex-formulary/branches/stu2-draft/StructureDefinition-usdf-PayerInsurancePlan.html">PayerInsurancePlan</a></strong>: The PayerInsurancePlan profile of the FHIR R4 <a href="http://hl7.org/fhir/R4/insuranceplan.html">InsurancePlan</a> resource defines the top level package of health insurance coverage benefits that a payer offers.
  </li>
  <li>
    <strong><a href="https://build.fhir.org/ig/HL7/davinci-pdex-formulary/branches/stu2-draft/StructureDefinition-usdf-InsuranceDrugPlan.html">InsuranceDrugPlan</a></strong>: The InsuranceDrugPlan profile of the FHIR R4 <a href="http://hl7.org/fhir/R4/insuranceplan.html">InsurancePlan</a> describes a prescription drug insurance offering comprised of drug benefits including a definition of drug tiers and their associated cost-sharing models and additional information about the plan, such as networks, a coverage area, contact information, etc.
  </li>
  <li>
    <strong><a href="https://build.fhir.org/ig/HL7/davinci-pdex-formulary/branches/stu2-draft/StructureDefinition-usdf-FormularyItem.html">FormularyItem</a></strong>: The FormularyItem profile of the FHIR R4 <a href="http://hl7.org/fhir/R4/basic.html">Basic</a> describes a drug's relationship to a drug plan, including drug tier, prior authorization requirements, and more. The set of FormuaryItem resrouces associated with a particular drug plan represents the drug plans formulary.
  </li>
  <li>
    <strong><a href="https://build.fhir.org/ig/HL7/davinci-pdex-formulary/branches/stu2-draft/StructureDefinition-usdf-FormularyDrug.html">FormularyDrug</a></strong>: The FormularyDrug profile of the FHIR R4 <a href="http://hl7.org/fhir/medicationknowledge.html">MedicationKnowledge</a> resource provides information about a prescribable drug which may be part of a formulary including its RxNorm code, synonyms, and optionally drug classification and alternatives.
  </li>


## Instructions

### Generate

- `bundle install`
- edit `config.yml` as needed
- `bundle exec ruby generate.rb`

The generated files are placed in `output/`

### Generating export files

After generating the sample resources using the above commands the `export.json` and corresponding `ndjson` files can be generated by the following command:

```
bundle exec ruby convertNDJSON.rb
```

This will read all the files in the `output` directory and generate the new files in the `export` directory.

### Upload

- `bundle install`
- `bundle exec ruby upload.rb`
